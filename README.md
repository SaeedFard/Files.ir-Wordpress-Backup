# Files.ir Wordpress Backup

ุงูุฒูููู ูุฑุฏูพุฑุณ ุจุฑุง **ุจฺฉุงูพโฺฏุฑ ุฎูุฏฺฉุงุฑ (ุฑูุฒุงูู/ููุชฺฏ)** ุงุฒ **ุฏุชุงุจุณ** ู **ูุงูโูุง ููู** ู **ุขูพููุฏ ูุณุชูู ุฑู Files.ir** ุงุฒ ุทุฑู API.  
ุฏุงุฑุง Worker URL (ุจุฑุง ฺฉุฑุงูู ุณุณุชู)ุ ูุฏูโฺฏุฐุงุฑ ูพูุดู (ุจุง `parentId`/`relativePath`)ุ ูุฏุฑุช ูุงฺฏ ู ูฺฏูโุฏุงุฑ ูุณุฎูโูุง ูุญู.

> **Author:** Saeed Fard โ <https://github.com/SaeedFard>  
> **Requires:** WordPress โฅ 5.6, PHP โฅ 7.4

---

## ูฺฺฏโูุง

- ุจฺฉุงูพ **ุฏุชุงุจุณ** (mysqldump ุง ุฎุฑูุฌ PHP ุฏุฑ ุตูุฑุช ูุจูุฏู mysqldump)
- ุจฺฉุงูพ **ูุงูโูุง** (ZIP ุง TAR.GZ) ุจุง:
  - ูุณุฑูุง ูุงุจู ุงูุชุฎุงุจ (uploads/themes/plugins โฆ)
  - ุงูฺฉุงู **ุดุงูู ฺฉุฑุฏู** `wp-config.php` ู `.htaccess`
  - **ุงูฺฏููุง ุญุฐู** (Glob: `*` ู `?`)
- ุฒูุงูโุจูุฏ **ุฑูุฒุงูู/ููุชฺฏ** ุจุง ุณุงุนุช/ุฏููู ุฏูุฎูุงู
- ุขูพููุฏ ูุณุชูู ุจู Files.ir (Authorization: **Bearer** token)
- ูุฏูโฺฏุฐุงุฑ ูพูุดูู ููุตุฏ ุจุง `parentId` ุง `relativePath`
- **Worker URL** (ุงุฌุฑุง ูุณุชูู ุจุฏูู WP-Cronุ ููุงุณุจ cronjob ุณุฑูุฑ)
- ูฺฏูโุฏุงุฑ **ูุณุฎูโูุง ูุญู** + **ูพุงฺฉโุณุงุฒ ุฎูุฏฺฉุงุฑ** (Retention)
- ูุฏุฑุช ูุงฺฏ ุฏุงุฎู ูพุดุฎูุงู (ููุงุด/ูพุงฺฉโุณุงุฒ/ุญุฐู ูุงฺฏ)
- ุญุงูุชโูุง ุณุงุฒฺฏุงุฑ ุจุฑุง ุณุฑูุฑูุง ุญุณุงุณ ุจู multipart/Expect

---

## ๐งฉ ูพุดโูุงุฒูุง

- PHP 7.4+  
- WordPress 5.6+  
- ุจุฑุง ZIP: ุงูุฒูููู PHP `zip` (ฺฉูุงุณ `ZipArchive`)  
- ุจุฑุง TAR.GZ (ุงุฎุชุงุฑ): `PharData` ู `phar.readonly = Off` (ุฏุฑ ูุจูุฏุดุ **ุฎูุฏฺฉุงุฑ** ุจู ZIP ุณูุฆฺ ูโุดูุฏ)

---

## ๐ ุดุฑูุน ุณุฑุน

1. ูุงู ZIP ุงูุฒููู ุฑุง ูุตุจ/ูุนุงู ฺฉูุฏ.  
2. ุจู **ุชูุธูุงุช โ Files.ir Wordpress Backup** ุจุฑูุฏ.  
3. ูุณูุช **API** ุฑุง ุงูโุทูุฑ ูพุฑ ฺฉูุฏ:
   - **Endpoint:** `https://my.files.ir/api/v1/uploads`
   - **Header:** `Authorization`
   - **Prefix:** `Bearer `
   - **Token:** ุชูฺฉู Files.ir
   - **Multipart field:** `file`
4. (ุงุฎุชุงุฑ) **ููุฏูุง ุงุถุงูู (JSON)** ุจุฑุง ูุฏูโฺฏุฐุงุฑ ูพูุดู:  
   ```json
   { "parentId": 11848 }
   ```
   ุง ุงฺฏุฑ ูโุฎูุงูุฏ ูุงู ูุงู ุฑู ูุณุฑ ุฎุงุต ุจูุดูุฏ:
   ```json
   { "relativePath": "wp-backups/my-site/db-20250101.sql.gz" }
   ```
5. ุฒูุงูโุจูุฏ ุฑุง ุฑู **ุฑูุฒุงูู** ุง **ููุชฺฏ** ุชูุธู ฺฉูุฏ ู ุฐุฎุฑู ุจุฒูุฏ.  
6. ุงุฒ ุฏฺฉููู ยซุงุฌุฑุง ุฏุฑ ูพุณโุฒูููยป ุจุฑุง ุชุณุช ุขู ุงุณุชูุงุฏู ฺฉูุฏ.

> ูพูุงฺฏู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ููุฏูุง ุงุทูุงุนุงุช `site`, `db`, `created_at` ุฑุง ููุฑุงู ูุงู ูโูุฑุณุชุฏ.

---

## ๐๏ธ ูพุฏุง ฺฉุฑุฏู `parentId` ูููุฏุฑ ููุตุฏ

ุจุฑุง ุขูพููุฏ ุฏุฑ ูพูุดูู ุฎุงุตุ ุจุงุฏ **ID** ุขู ูููุฏุฑ ุฑุง ุจุฏุงูุฏ:

- ุงุฒ API Files.ir:  
  ```
  GET /api/v1/drive/file-entries?type=folder&query=test&perPage=50
  ```
  ุฏุฑ ูุชุฌูู JSONุ ููุฏ `id` ููุงู `parentId` ุงุณุช.  
- ุง ุฏุฑ UI Files.irุ ฺฏุงู `id` ุฏุฑ URL/ูุชุงุฏุชุง ูุงุจู ูุดุงูุฏู ุงุณุช.

**ูฺฉุชู:** ุงฺฏุฑ `relativePath` ุจุฏูุฏุ ูุงุฒ ุจู `parentId` ูุณุช.

---

## โฑ๏ธ ฺฉุฑุงู ู ุงุฌุฑุง ูพุณโุฒููู

- ูุฑุฏูพุฑุณ ุจูโุดฺฉู ูพุดโูุฑุถ ุงุฒ **WP-Cron** ุงุณุชูุงุฏู ูโฺฉูุฏ (ูุงุจุณุชู ุจู ุจุงุฒุฏุฏ).  
- ุจุฑุง ุงุฌุฑุงูุง ุฏูู ู ูุณุชูู ุงุฒ ุชุฑุงูฺฉุ ุงุฒ **Worker URL** ุงุณุชูุงุฏู ฺฉูุฏ:
  - ุขุฏุฑุณ Worker ู **ฺฉูุฏ ูุฎู** ุฏุฑ ุตูุญูู ุชูุธูุงุช ููุงุด ุฏุงุฏู ูโุดูุฏ.
  - ููุงู URL ุฑุง ุฏุฑ cron ุณุฑูุฑ ุตุฏุง ุจุฒูุฏ (ูุฑ ุฑูุฒ/ุณุงุนุช โฆ).
- ุฏฺฉููโูุง ููุฏ:
  - ยซุงุฌุฑุง ุฏุฑ ูพุณโุฒููู (WP-Cron)ยป
  - ยซุงุฌุฑุง ูุณุชูู โ ุจุฏูู WP-Cronยป
  - ยซุชุณุช ุขูพููุฏ ฺฉูฺฺฉยป

---

## ๐งฐ ุชูุธูุงุช ูุงูโูุง

- **ุดุงููโูุง** (relative ุจู ุฑุดูู ูุฑุฏูพุฑุณ): ูุฑ ุฎุท ฺฉ ูุณุฑุ ูุซู:
  ```
  wp-content/uploads
  wp-content/themes
  wp-content/plugins
  ```
- **ุญุฐูโูุง**: ุงูฺฏู Glob (`cache`, `*.log`, `node_modules`ุ โฆ).  
- **ูุฑูุช ุขุฑุดู**: ZIP (ูพุดโูุฑุถ) ุง TAR.GZ (ุฏุฑ ุฏุณุชุฑุณ ุจูุฏู PharData ูุงุฒู ุงุณุช).

---

## ๐๏ธ ูฺฏูโุฏุงุฑ ูุญู (Retention)

- ุงฺฏุฑ ยซูฺฏู ุฏุงุดุชู ฺฉูพ ูุญูยป ูุนุงู ุจุงุดุฏุ ุงูุฒููู N ูุณุฎูู ุขุฎุฑ ุงุฒ ูุงูโูุง `.sql.gz` ู ุขุฑุดู ูุงูโูุง (`.zip`/`.tar.gz`) ุฑุง ุฏุฑ:
  ```
  wp-content/uploads/files-ir-wordpress-backup/
  ```
  ูฺฏู ูโุฏุงุฑุฏ ู ุจูู ุฑุง ุญุฐู ูโฺฉูุฏ.  
- ุงฺฏุฑ ูพูุดูู ุฌุฏุฏ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุงูุฒููู ุจูโุทูุฑ ููุดููุฏ ุงุฒ ูพูุดูู ูุฏู `files-db-uploader/` ุงุณุชูุงุฏู ูโฺฉูุฏ.

---

## ๐ ูฺฉุงุช ุงููุช

- **ฺฉูุฏ ูุฎู Worker** ุฑุง ุนููู ูฺฉูุฏ. ุฏุฑ ุตูุฑุช ูุฒูู ุงุฒ ุฏฺฉููู ยซุชููุฏ ฺฉูุฏ ุฌุฏุฏยป ุงุณุชูุงุฏู ฺฉูุฏ.  
- ุชูฺฉู Files.ir ุฑุง ููุท ุฏุฑ ุณุฑูุฑ ูุทูุฆู ูฺฏู ุฏุงุฑุฏ.  
- ุงฺฏุฑ ุขุฏุฑุณ Worker ุฑุง ุฏุฑ cron ูโฺฏุฐุงุฑุฏุ ูุทูุฆู ุดูุฏ ุจูโุตูุฑุช HTTPS ู ุจุง ฺฉูุฏ ุฏุฑุณุช ุงุณุช.

---

## ๐งช ุฎุทุงูุง ุฑุงุฌ ู ุฑุงูโุญูโูุง

| ูพุงู | ุฏูู ูุญุชูู | ุฑุงูฺฉุงุฑ |
|---|---|---|
| **405 Method Not Allowed** | Endpoint ุงุดุชุจุงู (`/api/v1/uploads` ุตุญุญ ุงุณุช) ุง ุฑูุด ูุงุตุญุญ | ุขุฏุฑุณ ู ูุชุฏ ุฑุง ฺฺฉ ฺฉูุฏ (POST/PUT) |
| **401/403** | ูุฏุฑ `Authorization`/ุชูฺฉู ูุงุฏุฑุณุช | ููุฏุงุฑ `Bearer {TOKEN}` ุฑุง ุจุฑุฑุณ ฺฉูุฏ |
| **500 ุงุฒ Files.ir** | ูุญุฏูุฏุช ุง ุฎุทุง ุณูุช ุณุฑูุฑ | ุจุนุฏุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏุ ุงูุฏุงุฒูู ูุงู/ููุฏูุง ุฑุง ุจุงุฒุจู ฺฉูุฏ |
| **Request Timeout** | ุฒูุงู ุงุฌุฑุง ุทููุงู (ุขุฑุดู ุจุฒุฑฺฏ) | ุงุฌุฑุง ูพุณโุฒููู/Worker ู ุงูุฒุงุด timeout |
| **PharData ุฏุฑ ุฏุณุชุฑุณ ูุณุช** | `phar.readonly=On` | ุงุฒ ZIP ุงุณุชูุงุฏู ฺฉูุฏ (ุงูุฒููู ุฎูุฏฺฉุงุฑ ุณูุฆฺ ูโฺฉูุฏ) |
| **WP-Cron ุงุฌุฑุง ููโุดูุฏ** | ุชุฑุงูฺฉ ฺฉู ุง `DISABLE_WP_CRON` | ุงุฒ Worker URL ุง cron ุณุณุชู ุงุณุชูุงุฏู ฺฉูุฏ |

ูุงฺฏโูุง ุฏุฑ ูุณุฑ ุฒุฑ ุฐุฎุฑู ูโุดูุฏ ู ุงุฒ ููุงูโุฌุง ุฏุฑ ูพุดุฎูุงู ูุงุจู ูพุงฺฉโุณุงุฒ/ุญุฐู ุงุณุช:  
`wp-content/uploads/files-ir-wordpress-backup/logs.txt`

---

## ๐๏ธ ุชูุณุนู

- ุงุณูุงฺฏ ุงูุฒููู: `files-ir-wordpress-backup`  
- ุชูุธูุงุช ุฐุฎุฑู ูโุดูุฏ ุฏุฑ: `fdu_settings`  
- ุฑูุฏุงุฏูุง ฺฉุฑุงู: `fdu_cron_upload_event`, `fdu_async_run_event`  
- ุชุบุฑ ูุงู/ุงุณูุงฺฏ ุงุฒ ูุณุฎูโูุง ูุฏู (Files DB Uploader) **ุจุง ููุงุฌุฑุช ุงูู** ุงูุฌุงู ุดุฏู ู ุชูุธูุงุช ูุจู ุญูุธ ูโุดูุฏ.

Pull Requestโูุง ู Issueูุง ุฎูุดโุขูุฏูุฏ โ๏ธ

---

## ๐ ูุฌูุฒ

GPL-2.0-or-later โ ุจุจู: <https://www.gnu.org/licenses/gpl-2.0.html>

---

## ๐๏ธ ุชุบุฑุงุช

- **1.0.2** โ ููฺฉ ยซุชูุธูุงุชยป ุฏุฑ ูุณุช ุงูุฒูููโูุง (Plugins)  
- **1.0.1** โ ุงุตูุงุญ ุชุงูพ ุฏุฑ ูุงฺฏโูุง (`spawn_cron` / `doing_wp_cron`)  
- **1.0.0** โ ุชุบุฑ ุงุณูุงฺฏ ุจู `files-ir-wordpress-backup` ุจุง ุญูุธ ฺฉุงูู ุชูุธูุงุช ู ฺฉุฑุงู  
- **0.3.x** โ ุงุถุงูู ุดุฏู Worker URLุ ูุฏุฑุช ูุงฺฏุ ุจฺฉุงูพ ูุงูโูุงุ ู ุจูุจูุฏูุง API
